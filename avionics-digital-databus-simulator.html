<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ARINC 429 Digital Data Bus Simulator - AEA Training Hangar</title>
    <style>
        :root {
            --neon-cyan: #00ffff;
            --neon-magenta: #ff00ff;
            --neon-lime: #39ff14;
            --neon-amber: #ffbf00;
            --dark-bg: #0a0a0f;
            --panel-bg: #1a1a2e;
            --text-primary: #e0e0ff;
            --grid-color: #2a2a4a;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
            background: var(--dark-bg);
            color: var(--text-primary);
            line-height: 1.6;
            overflow-x: hidden;
        }

        .container {
            max-width: 1600px;
            margin: 0 auto;
            padding: 20px;
        }

        header {
            text-align: center;
            padding: 20px 0;
            border-bottom: 2px solid var(--neon-cyan);
            margin-bottom: 30px;
        }

        h1 {
            font-size: 2.5rem;
            color: var(--neon-cyan);
            text-shadow: 0 0 10px var(--neon-cyan);
            margin-bottom: 10px;
        }

        .subtitle {
            color: var(--neon-amber);
            font-size: 1.1rem;
        }

        .main-content {
            display: grid;
            grid-template-columns: 1fr 350px;
            gap: 20px;
            margin-bottom: 20px;
        }

        .oscilloscope-panel {
            background: var(--panel-bg);
            border: 2px solid var(--neon-cyan);
            border-radius: 10px;
            padding: 20px;
            box-shadow: 0 0 20px rgba(0, 255, 255, 0.3);
        }

        .scope-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }

        .scope-title {
            font-size: 1.5rem;
            color: var(--neon-lime);
        }

        .scope-status {
            display: flex;
            gap: 15px;
            align-items: center;
        }

        .status-indicator {
            display: flex;
            align-items: center;
            gap: 5px;
            font-size: 0.9rem;
        }

        .led {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            background: var(--neon-lime);
            box-shadow: 0 0 10px var(--neon-lime);
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }

        .canvas-container {
            position: relative;
            background: #000;
            border: 2px solid #333;
            border-radius: 5px;
            margin-bottom: 15px;
        }

        canvas {
            display: block;
            width: 100%;
            height: auto;
        }

        .channel-controls {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 10px;
            margin-bottom: 15px;
        }

        .channel-control {
            background: rgba(0, 255, 255, 0.1);
            border: 1px solid var(--neon-cyan);
            border-radius: 5px;
            padding: 10px;
        }

        .channel-control.ch1 { border-color: #ffff00; }
        .channel-control.ch2 { border-color: #00ffff; }
        .channel-control.math { border-color: #ff00ff; }

        .channel-label {
            font-weight: bold;
            margin-bottom: 5px;
            display: flex;
            align-items: center;
            gap: 5px;
        }

        .channel-indicator {
            width: 8px;
            height: 8px;
            border-radius: 50%;
        }

        .ch1 .channel-indicator { background: #ffff00; }
        .ch2 .channel-indicator { background: #00ffff; }
        .math .channel-indicator { background: #ff00ff; }

        .channel-toggle {
            display: flex;
            align-items: center;
            gap: 5px;
            margin-top: 5px;
        }

        input[type="checkbox"] {
            width: 18px;
            height: 18px;
            cursor: pointer;
        }

        .scope-controls {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 10px;
        }

        .control-group {
            background: rgba(0, 255, 255, 0.05);
            padding: 10px;
            border-radius: 5px;
        }

        .control-label {
            display: block;
            font-size: 0.9rem;
            color: var(--neon-amber);
            margin-bottom: 5px;
        }

        select, input[type="number"] {
            width: 100%;
            padding: 8px;
            background: var(--dark-bg);
            border: 1px solid var(--neon-cyan);
            border-radius: 3px;
            color: var(--text-primary);
            font-size: 0.9rem;
        }

        .control-panel {
            background: var(--panel-bg);
            border: 2px solid var(--neon-magenta);
            border-radius: 10px;
            padding: 20px;
            box-shadow: 0 0 20px rgba(255, 0, 255, 0.3);
        }

        .panel-section {
            margin-bottom: 20px;
            padding-bottom: 20px;
            border-bottom: 1px solid var(--grid-color);
        }

        .panel-section:last-child {
            border-bottom: none;
        }

        .section-title {
            font-size: 1.2rem;
            color: var(--neon-magenta);
            margin-bottom: 15px;
        }

        .button-group {
            display: grid;
            gap: 10px;
        }

        button {
            padding: 12px 20px;
            font-size: 1rem;
            font-weight: bold;
            border: 2px solid var(--neon-cyan);
            border-radius: 5px;
            background: var(--dark-bg);
            color: var(--neon-cyan);
            cursor: pointer;
            transition: all 0.3s ease;
            text-transform: uppercase;
        }

        button:hover {
            background: var(--neon-cyan);
            color: var(--dark-bg);
            box-shadow: 0 0 15px var(--neon-cyan);
        }

        button.active {
            background: var(--neon-lime);
            border-color: var(--neon-lime);
            color: var(--dark-bg);
        }

        button.danger {
            border-color: #ff3333;
            color: #ff3333;
        }

        button.danger:hover {
            background: #ff3333;
            color: white;
        }

        .info-box {
            background: rgba(255, 191, 0, 0.1);
            border-left: 4px solid var(--neon-amber);
            padding: 15px;
            margin-bottom: 15px;
            border-radius: 5px;
        }

        .info-title {
            font-weight: bold;
            color: var(--neon-amber);
            margin-bottom: 5px;
        }

        .data-display {
            font-family: 'Courier New', monospace;
            background: #000;
            border: 1px solid var(--neon-cyan);
            border-radius: 3px;
            padding: 10px;
            margin-top: 10px;
            overflow-x: auto;
        }

        .bit-value {
            color: var(--neon-lime);
        }

        .measurements {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 10px;
            margin-top: 15px;
        }

        .measurement {
            background: rgba(0, 255, 255, 0.05);
            padding: 10px;
            border-radius: 5px;
            border: 1px solid var(--grid-color);
        }

        .measurement-label {
            font-size: 0.8rem;
            color: var(--neon-amber);
        }

        .measurement-value {
            font-size: 1.2rem;
            font-weight: bold;
            color: var(--neon-cyan);
            font-family: 'Courier New', monospace;
        }

        .instructions {
            background: var(--panel-bg);
            border: 2px solid var(--neon-lime);
            border-radius: 10px;
            padding: 20px;
            margin-top: 20px;
        }

        .instructions h2 {
            color: var(--neon-lime);
            margin-bottom: 15px;
        }

        .instructions ol {
            margin-left: 20px;
        }

        .instructions li {
            margin-bottom: 10px;
        }

        .back-button {
            position: fixed;
            top: 20px;
            left: 20px;
            padding: 10px 20px;
            background: var(--dark-bg);
            border: 2px solid var(--neon-cyan);
            color: var(--neon-cyan);
            text-decoration: none;
            border-radius: 5px;
            font-weight: bold;
            transition: all 0.3s ease;
            z-index: 1000;
        }

        .back-button:hover {
            background: var(--neon-cyan);
            color: var(--dark-bg);
            box-shadow: 0 0 15px var(--neon-cyan);
        }

        @media (max-width: 1200px) {
            .main-content {
                grid-template-columns: 1fr;
            }

            .scope-controls {
                grid-template-columns: repeat(3, 1fr);
            }
        }

        @media (max-width: 768px) {
            h1 {
                font-size: 1.8rem;
            }

            .scope-controls {
                grid-template-columns: 1fr;
            }

            .channel-controls {
                grid-template-columns: 1fr;
            }

            .measurements {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <a href="index.html" class="back-button">← Back to Hub</a>

    <div class="container">
        <header>
            <h1>ARINC 429 Digital Data Bus Simulator</h1>
            <p class="subtitle">Interactive Oscilloscope Training for Avionics Students</p>
        </header>

        <div class="main-content">
            <!-- Oscilloscope Panel -->
            <div class="oscilloscope-panel">
                <div class="scope-header">
                    <h2 class="scope-title">Virtual Oscilloscope</h2>
                    <div class="scope-status">
                        <div class="status-indicator">
                            <div class="led"></div>
                            <span id="statusText">Running</span>
                        </div>
                    </div>
                </div>

                <div class="canvas-container">
                    <canvas id="oscilloscope" width="1200" height="600"></canvas>
                </div>

                <div class="channel-controls">
                    <div class="channel-control ch1">
                        <div class="channel-label">
                            <span class="channel-indicator"></span>
                            CH1 - ARINC Hi
                        </div>
                        <div class="channel-toggle">
                            <input type="checkbox" id="ch1Toggle" checked>
                            <label for="ch1Toggle">Display</label>
                        </div>
                    </div>

                    <div class="channel-control ch2">
                        <div class="channel-label">
                            <span class="channel-indicator"></span>
                            CH2 - ARINC Lo
                        </div>
                        <div class="channel-toggle">
                            <input type="checkbox" id="ch2Toggle" checked>
                            <label for="ch2Toggle">Display</label>
                        </div>
                    </div>

                    <div class="channel-control math">
                        <div class="channel-label">
                            <span class="channel-indicator"></span>
                            MATH (CH1-CH2)
                        </div>
                        <div class="channel-toggle">
                            <input type="checkbox" id="mathToggle" checked>
                            <label for="mathToggle">Display</label>
                        </div>
                    </div>
                </div>

                <div class="scope-controls">
                    <div class="control-group">
                        <label class="control-label">Time/Div (μs)</label>
                        <select id="timeScale">
                            <option value="1">1 μs</option>
                            <option value="2">2 μs</option>
                            <option value="5" selected>5 μs</option>
                            <option value="10">10 μs</option>
                            <option value="20">20 μs</option>
                            <option value="50">50 μs</option>
                        </select>
                    </div>

                    <div class="control-group">
                        <label class="control-label">Voltage/Div (V)</label>
                        <select id="voltageScale">
                            <option value="1">1 V</option>
                            <option value="2">2 V</option>
                            <option value="5" selected>5 V</option>
                            <option value="10">10 V</option>
                        </select>
                    </div>

                    <div class="control-group">
                        <label class="control-label">Trigger Level (V)</label>
                        <input type="number" id="triggerLevel" value="5" min="0" max="10" step="0.5">
                    </div>

                    <div class="control-group">
                        <label class="control-label">Trigger Edge</label>
                        <select id="triggerEdge">
                            <option value="rising" selected>Rising</option>
                            <option value="falling">Falling</option>
                        </select>
                    </div>
                </div>

                <div class="measurements">
                    <div class="measurement">
                        <div class="measurement-label">Frequency</div>
                        <div class="measurement-value" id="freqMeasure">100 kHz</div>
                    </div>
                    <div class="measurement">
                        <div class="measurement-label">Period</div>
                        <div class="measurement-value" id="periodMeasure">10 μs</div>
                    </div>
                    <div class="measurement">
                        <div class="measurement-label">Vpp (Differential)</div>
                        <div class="measurement-value" id="vppMeasure">10 V</div>
                    </div>
                    <div class="measurement">
                        <div class="measurement-label">Bit Rate</div>
                        <div class="measurement-value" id="bitRateMeasure">100 kbps</div>
                    </div>
                </div>
            </div>

            <!-- Control Panel -->
            <div class="control-panel">
                <div class="panel-section">
                    <h3 class="section-title">Simulation Control</h3>
                    <div class="button-group">
                        <button id="playPauseBtn" class="active">⏸ Pause</button>
                        <button id="singleBtn">Single Shot</button>
                        <button id="resetBtn" class="danger">⟲ Reset</button>
                    </div>
                </div>

                <div class="panel-section">
                    <h3 class="section-title">ARINC 429 Settings</h3>

                    <div class="control-group">
                        <label class="control-label">Data Rate</label>
                        <select id="dataRate">
                            <option value="12.5">12.5 kbps (Low Speed)</option>
                            <option value="100" selected>100 kbps (High Speed)</option>
                        </select>
                    </div>

                    <div class="control-group" style="margin-top: 10px;">
                        <label class="control-label">Voltage High (V)</label>
                        <input type="number" id="voltageHigh" value="10" min="5" max="13" step="0.5">
                    </div>

                    <div class="control-group" style="margin-top: 10px;">
                        <label class="control-label">Voltage Low (V)</label>
                        <input type="number" id="voltageLow" value="0" min="0" max="5" step="0.5">
                    </div>
                </div>

                <div class="panel-section">
                    <h3 class="section-title">Current Word</h3>
                    <div class="info-box">
                        <div class="info-title">32-Bit ARINC 429 Word</div>
                        <div class="data-display" id="currentWord">
                            <div style="margin-bottom: 5px;">Label: <span class="bit-value">377 (octal)</span></div>
                            <div style="margin-bottom: 5px;">SDI: <span class="bit-value">00</span></div>
                            <div style="margin-bottom: 5px;">Data: <span class="bit-value">0x12345</span></div>
                            <div style="margin-bottom: 5px;">SSM: <span class="bit-value">00</span></div>
                            <div>Parity: <span class="bit-value">Odd</span></div>
                        </div>
                    </div>

                    <button id="newWordBtn" style="width: 100%; margin-top: 10px;">Generate New Word</button>
                </div>

                <div class="panel-section">
                    <h3 class="section-title">About ARINC 429</h3>
                    <div class="info-box">
                        <p style="font-size: 0.9rem;">
                            ARINC 429 is a two-wire, unidirectional data bus standard used extensively in commercial aircraft.
                            It uses differential signaling where data is represented by the voltage difference between Hi and Lo wires.
                        </p>
                    </div>
                    <div class="info-box">
                        <div class="info-title">Differential Signaling</div>
                        <p style="font-size: 0.85rem;">
                            <strong>Logic 1 (High):</strong> Hi = 10V, Lo = 0V<br>
                            <strong>Logic 0 (Low):</strong> Hi = 0V, Lo = 10V<br>
                            <strong>Null (Idle):</strong> Hi = 0V, Lo = 0V
                        </p>
                    </div>
                </div>
            </div>
        </div>

        <!-- Instructions -->
        <div class="instructions">
            <h2>Lab Exercise: Physical Signal Characteristics</h2>

            <div class="info-box">
                <div class="info-title">Equipment Setup (Simulated)</div>
                <p>
                    ✓ Channel 1 connected to ARINC Hi wire<br>
                    ✓ Channel 2 connected to ARINC Lo wire<br>
                    ✓ Math function set to display CH1-CH2 (differential mode)
                </p>
            </div>

            <ol>
                <li><strong>Observe Individual Signals:</strong> Toggle CH1 and CH2 visibility to observe the Hi and Lo signals independently. Note how they are inverse of each other during data transmission.</li>

                <li><strong>View Differential Signal:</strong> Enable the MATH (CH1-CH2) channel to see the actual differential signal. This is what the receiving equipment decodes.</li>

                <li><strong>Measure Bit Timing:</strong> Adjust the Time/Div control to clearly see individual bit periods. For 100 kbps, each bit should be 10 μs wide.</li>

                <li><strong>Verify Voltage Levels:</strong> Adjust Voltage/Div to measure the voltage swing. The differential signal should show a peak-to-peak voltage (Vpp) of approximately 10V.</li>

                <li><strong>Test Different Data Rates:</strong> Switch between 12.5 kbps and 100 kbps to see how bit timing changes. Calculate the expected bit period for each rate.</li>

                <li><strong>Analyze Word Structure:</strong> Observe a complete 32-bit ARINC 429 word. Identify the label bits (bits 1-8), data field, and parity bit (bit 32).</li>

                <li><strong>Trigger Practice:</strong> Adjust the trigger level and edge settings to capture the start of a new word transmission.</li>

                <li><strong>Generate New Words:</strong> Click "Generate New Word" to transmit different data patterns and observe how the waveform changes.</li>
            </ol>
        </div>
    </div>

    <script>
        // Canvas and context
        const canvas = document.getElementById('oscilloscope');
        const ctx = canvas.getContext('2d');

        // Simulation state
        let isRunning = true;
        let timeOffset = 0;
        let currentBitIndex = 0;
        let currentWord = generateARINC429Word();

        // Settings
        let settings = {
            timeScale: 5, // μs per division
            voltageScale: 5, // V per division
            dataRate: 100, // kbps
            voltageHigh: 10,
            voltageLow: 0,
            triggerLevel: 5,
            triggerEdge: 'rising',
            showCh1: true,
            showCh2: true,
            showMath: true
        };

        // Generate random ARINC 429 word
        function generateARINC429Word() {
            const label = Math.floor(Math.random() * 256); // 8 bits
            const sdi = Math.floor(Math.random() * 4); // 2 bits
            const data = Math.floor(Math.random() * 0x7FFFF); // 19 bits
            const ssm = Math.floor(Math.random() * 4); // 2 bits

            // Build 32-bit word (LSB first for ARINC 429)
            let word = 0;
            word |= label;
            word |= (sdi << 8);
            word |= (data << 10);
            word |= (ssm << 29);

            // Calculate odd parity for bit 32
            let parity = 0;
            for (let i = 0; i < 31; i++) {
                parity ^= (word >> i) & 1;
            }
            word |= (parity << 31);

            return {
                word: word,
                label: label,
                sdi: sdi,
                data: data,
                ssm: ssm,
                parity: parity,
                bits: convertToBits(word)
            };
        }

        function convertToBits(word) {
            const bits = [];
            for (let i = 0; i < 32; i++) {
                bits.push((word >> i) & 1);
            }
            return bits;
        }

        function updateWordDisplay() {
            const labelOctal = currentWord.label.toString(8).padStart(3, '0');
            const dataHex = currentWord.data.toString(16).toUpperCase().padStart(5, '0');
            const sdibin = currentWord.sdi.toString(2).padStart(2, '0');
            const ssmBin = currentWord.ssm.toString(2).padStart(2, '0');

            document.getElementById('currentWord').innerHTML = `
                <div style="margin-bottom: 5px;">Label: <span class="bit-value">${labelOctal} (octal)</span></div>
                <div style="margin-bottom: 5px;">SDI: <span class="bit-value">${sdibin}</span></div>
                <div style="margin-bottom: 5px;">Data: <span class="bit-value">0x${dataHex}</span></div>
                <div style="margin-bottom: 5px;">SSM: <span class="bit-value">${ssmBin}</span></div>
                <div>Parity: <span class="bit-value">${currentWord.parity ? 'Odd' : 'Even'}</span></div>
            `;
        }

        // Get signal value at time t (in microseconds)
        function getSignalValue(t, channel) {
            const bitPeriod = 1000 / settings.dataRate; // μs per bit
            const wordPeriod = bitPeriod * 32; // μs per word
            const gapPeriod = bitPeriod * 4; // 4-bit gap between words
            const totalPeriod = wordPeriod + gapPeriod;

            const tMod = t % totalPeriod;

            // During gap period, return NULL state
            if (tMod >= wordPeriod) {
                return channel === 'hi' ? 0 : 0;
            }

            const bitIndex = Math.floor(tMod / bitPeriod);
            const bitValue = currentWord.bits[bitIndex];

            if (channel === 'hi') {
                return bitValue === 1 ? settings.voltageHigh : settings.voltageLow;
            } else if (channel === 'lo') {
                return bitValue === 1 ? settings.voltageLow : settings.voltageHigh;
            } else { // differential
                const hiValue = bitValue === 1 ? settings.voltageHigh : settings.voltageLow;
                const loValue = bitValue === 1 ? settings.voltageLow : settings.voltageHigh;
                return hiValue - loValue;
            }
        }

        function drawGrid() {
            const width = canvas.width;
            const height = canvas.height;
            const divisions = 10;

            ctx.strokeStyle = '#1a1a2a';
            ctx.lineWidth = 1;

            // Vertical lines
            for (let i = 0; i <= divisions; i++) {
                const x = (width / divisions) * i;
                ctx.beginPath();
                ctx.moveTo(x, 0);
                ctx.lineTo(x, height);
                ctx.stroke();
            }

            // Horizontal lines
            for (let i = 0; i <= divisions; i++) {
                const y = (height / divisions) * i;
                ctx.beginPath();
                ctx.moveTo(0, y);
                ctx.lineTo(width, y);
                ctx.stroke();
            }

            // Center lines (brighter)
            ctx.strokeStyle = '#2a2a4a';
            ctx.lineWidth = 2;

            // Vertical center
            ctx.beginPath();
            ctx.moveTo(width / 2, 0);
            ctx.lineTo(width / 2, height);
            ctx.stroke();

            // Horizontal center
            ctx.beginPath();
            ctx.moveTo(0, height / 2);
            ctx.lineTo(width, height / 2);
            ctx.stroke();
        }

        function drawWaveform(startTime, channel, color) {
            const width = canvas.width;
            const height = canvas.height;
            const samples = width;
            const timeRange = settings.timeScale * 10; // Total time span in μs

            ctx.strokeStyle = color;
            ctx.lineWidth = 2;
            ctx.beginPath();

            for (let i = 0; i < samples; i++) {
                const t = startTime + (i / samples) * timeRange;
                const voltage = getSignalValue(t, channel);

                // Convert voltage to y coordinate
                // Center is 0V for differential, voltageHigh/2 for individual signals
                let centerVoltage = channel === 'diff' ? 0 : settings.voltageHigh / 2;
                const voltageRange = settings.voltageScale * 10;
                const y = height / 2 - (voltage - centerVoltage) * (height / voltageRange);

                if (i === 0) {
                    ctx.moveTo(i, y);
                } else {
                    ctx.lineTo(i, y);
                }
            }

            ctx.stroke();
        }

        function drawLabels() {
            ctx.fillStyle = '#00ffff';
            ctx.font = '14px Courier New';

            // Time scale
            ctx.fillText(`${settings.timeScale} μs/div`, 10, 20);

            // Voltage scale
            ctx.fillText(`${settings.voltageScale} V/div`, 10, 40);

            // Trigger indicator
            ctx.fillText(`Trigger: ${settings.triggerLevel}V ${settings.triggerEdge}`, canvas.width - 200, 20);
        }

        function animate() {
            // Clear canvas
            ctx.fillStyle = '#000000';
            ctx.fillRect(0, 0, canvas.width, canvas.height);

            // Draw grid
            drawGrid();

            // Draw waveforms
            if (settings.showCh1) {
                drawWaveform(timeOffset, 'hi', '#ffff00');
            }

            if (settings.showCh2) {
                drawWaveform(timeOffset, 'lo', '#00ffff');
            }

            if (settings.showMath) {
                drawWaveform(timeOffset, 'diff', '#ff00ff');
            }

            // Draw labels
            drawLabels();

            // Update time offset if running
            if (isRunning) {
                timeOffset += 0.5; // Advance time
            }

            requestAnimationFrame(animate);
        }

        function updateMeasurements() {
            const bitPeriod = 1000 / settings.dataRate; // μs
            const frequency = 1000 / bitPeriod; // kHz

            document.getElementById('freqMeasure').textContent = `${frequency.toFixed(0)} kHz`;
            document.getElementById('periodMeasure').textContent = `${bitPeriod.toFixed(1)} μs`;
            document.getElementById('vppMeasure').textContent = `${settings.voltageHigh - settings.voltageLow} V`;
            document.getElementById('bitRateMeasure').textContent = `${settings.dataRate} kbps`;
        }

        // Event Listeners
        document.getElementById('playPauseBtn').addEventListener('click', function() {
            isRunning = !isRunning;
            this.textContent = isRunning ? '⏸ Pause' : '▶ Play';
            this.classList.toggle('active');
            document.getElementById('statusText').textContent = isRunning ? 'Running' : 'Paused';
        });

        document.getElementById('singleBtn').addEventListener('click', function() {
            if (!isRunning) {
                timeOffset += settings.timeScale * 10;
            }
        });

        document.getElementById('resetBtn').addEventListener('click', function() {
            timeOffset = 0;
            currentWord = generateARINC429Word();
            updateWordDisplay();
        });

        document.getElementById('newWordBtn').addEventListener('click', function() {
            currentWord = generateARINC429Word();
            updateWordDisplay();
        });

        document.getElementById('timeScale').addEventListener('change', function() {
            settings.timeScale = parseFloat(this.value);
        });

        document.getElementById('voltageScale').addEventListener('change', function() {
            settings.voltageScale = parseFloat(this.value);
        });

        document.getElementById('triggerLevel').addEventListener('input', function() {
            settings.triggerLevel = parseFloat(this.value);
        });

        document.getElementById('triggerEdge').addEventListener('change', function() {
            settings.triggerEdge = this.value;
        });

        document.getElementById('dataRate').addEventListener('change', function() {
            settings.dataRate = parseFloat(this.value);
            updateMeasurements();
        });

        document.getElementById('voltageHigh').addEventListener('input', function() {
            settings.voltageHigh = parseFloat(this.value);
            updateMeasurements();
        });

        document.getElementById('voltageLow').addEventListener('input', function() {
            settings.voltageLow = parseFloat(this.value);
            updateMeasurements();
        });

        document.getElementById('ch1Toggle').addEventListener('change', function() {
            settings.showCh1 = this.checked;
        });

        document.getElementById('ch2Toggle').addEventListener('change', function() {
            settings.showCh2 = this.checked;
        });

        document.getElementById('mathToggle').addEventListener('change', function() {
            settings.showMath = this.checked;
        });

        // Initialize
        updateWordDisplay();
        updateMeasurements();
        animate();
    </script>
</body>
</html>
