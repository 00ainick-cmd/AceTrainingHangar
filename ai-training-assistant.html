<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>AI Training Assistant - AEA LMS</title>
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Press+Start+2P&family=Inter:wght@400;600;700&display=swap');

    :root {
      --bg-navy: #0b0f2b;
      --bg-midnight: #0a0e1a;
      --neon-cyan: #33f6ff;
      --magenta: #ff68d7;
      --lime: #a8ff60;
      --amber: #ffc857;
      --text-light: #eaf2ff;
      --text-muted: #9fb1d6;
      --panel: #0f1620;
      --border-glow: rgba(51, 246, 255, 0.4);
      --success: #4ade80;
      --warning: #fbbf24;
      --error: #f87171;
    }

    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }

    body {
      background: var(--bg-navy);
      color: var(--text-light);
      font-family: 'Inter', system-ui, sans-serif;
      line-height: 1.6;
      min-height: 100vh;
    }

    /* CRT Effect */
    body::before {
      content: "";
      position: fixed;
      inset: 0;
      pointer-events: none;
      background: repeating-linear-gradient(
        0deg,
        rgba(0, 0, 0, 0.1) 0px,
        transparent 1px,
        transparent 2px,
        rgba(0, 0, 0, 0.1) 3px
      );
      z-index: 9999;
      animation: scanline 8s linear infinite;
    }

    @keyframes scanline {
      0%, 100% { opacity: 0.1; }
      50% { opacity: 0.08; }
    }

    .container {
      max-width: 1400px;
      margin: 0 auto;
      padding: 20px;
    }

    /* Header */
    .header {
      text-align: center;
      padding: 30px 20px;
      border-bottom: 2px solid var(--border-glow);
      margin-bottom: 30px;
    }

    .header h1 {
      font-family: 'Press Start 2P', monospace;
      font-size: clamp(18px, 3vw, 28px);
      color: var(--neon-cyan);
      margin-bottom: 12px;
      text-shadow: 0 0 20px var(--neon-cyan);
      animation: title-glow 2s ease-in-out infinite;
    }

    @keyframes title-glow {
      0%, 100% { text-shadow: 0 0 10px var(--neon-cyan), 0 0 20px rgba(51, 246, 255, 0.6); }
      50% { text-shadow: 0 0 15px var(--neon-cyan), 0 0 30px rgba(51, 246, 255, 0.8); }
    }

    .header p {
      color: var(--text-muted);
      font-size: 14px;
      text-transform: uppercase;
      letter-spacing: 0.08em;
    }

    .back-home {
      display: inline-flex;
      align-items: center;
      gap: 8px;
      background: linear-gradient(145deg, #1a2347, #12183a);
      border: 2px solid var(--magenta);
      color: var(--text-light);
      padding: 12px 20px;
      border-radius: 10px;
      font-size: 13px;
      font-weight: 700;
      letter-spacing: 0.08em;
      text-transform: uppercase;
      text-decoration: none;
      transition: all 200ms ease;
      margin-bottom: 20px;
    }

    .back-home:hover {
      transform: translateX(-3px);
      box-shadow: 0 6px 20px rgba(0, 0, 0, 0.5), 0 0 25px var(--magenta);
    }

    /* Layout Grid */
    .main-grid {
      display: grid;
      grid-template-columns: 300px 1fr 400px;
      gap: 20px;
      margin-bottom: 30px;
    }

    @media (max-width: 1200px) {
      .main-grid {
        grid-template-columns: 250px 1fr;
      }
      .ai-assistant-panel {
        grid-column: 1 / -1;
      }
    }

    @media (max-width: 768px) {
      .main-grid {
        grid-template-columns: 1fr;
      }
    }

    /* Panel Styles */
    .panel {
      background: linear-gradient(145deg, #121832, #0d1124);
      border: 2px solid var(--border-glow);
      border-radius: 16px;
      padding: 20px;
      box-shadow: 0 0 20px rgba(51, 246, 255, 0.2);
    }

    .panel h2 {
      font-family: 'Press Start 2P', monospace;
      font-size: 14px;
      color: var(--lime);
      margin-bottom: 20px;
      text-transform: uppercase;
      letter-spacing: 0.05em;
    }

    /* Course Library */
    .course-list {
      display: flex;
      flex-direction: column;
      gap: 12px;
    }

    .course-item {
      background: var(--panel);
      border: 2px solid rgba(255, 255, 255, 0.1);
      border-radius: 10px;
      padding: 15px;
      cursor: pointer;
      transition: all 200ms ease;
      position: relative;
    }

    .course-item:hover {
      border-color: var(--neon-cyan);
      box-shadow: 0 0 15px rgba(51, 246, 255, 0.3);
      transform: translateX(5px);
    }

    .course-item.active {
      border-color: var(--lime);
      background: linear-gradient(145deg, #1a2810, #12180a);
    }

    .course-item h3 {
      font-size: 14px;
      color: var(--neon-cyan);
      margin-bottom: 8px;
      font-weight: 700;
    }

    .course-item p {
      font-size: 12px;
      color: var(--text-muted);
      line-height: 1.4;
    }

    .course-progress {
      margin-top: 10px;
      height: 6px;
      background: rgba(0, 0, 0, 0.3);
      border-radius: 3px;
      overflow: hidden;
    }

    .course-progress-bar {
      height: 100%;
      background: linear-gradient(90deg, var(--neon-cyan), var(--lime));
      transition: width 400ms ease;
    }

    /* Course Content */
    .course-content {
      max-height: calc(100vh - 200px);
      overflow-y: auto;
    }

    .lesson {
      background: var(--panel);
      border: 1px solid rgba(255, 255, 255, 0.1);
      border-radius: 10px;
      padding: 20px;
      margin-bottom: 20px;
    }

    .lesson h3 {
      font-size: 18px;
      color: var(--amber);
      margin-bottom: 15px;
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .lesson-content {
      font-size: 14px;
      line-height: 1.8;
      color: var(--text-light);
      margin-bottom: 20px;
    }

    .lesson-content h4 {
      color: var(--lime);
      margin-top: 20px;
      margin-bottom: 10px;
    }

    .lesson-content ul {
      margin-left: 20px;
      margin-bottom: 15px;
    }

    .lesson-content li {
      margin-bottom: 8px;
    }

    .code-block {
      background: var(--bg-midnight);
      border: 1px solid rgba(51, 246, 255, 0.3);
      border-radius: 8px;
      padding: 15px;
      font-family: 'Courier New', monospace;
      font-size: 13px;
      color: var(--lime);
      overflow-x: auto;
      margin: 15px 0;
    }

    .assignment-box {
      background: linear-gradient(145deg, #2a2010, #1f1808);
      border: 2px solid var(--amber);
      border-radius: 10px;
      padding: 20px;
      margin-top: 20px;
    }

    .assignment-box h4 {
      color: var(--amber);
      margin-bottom: 15px;
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .assignment-submit {
      width: 100%;
      min-height: 100px;
      background: var(--bg-midnight);
      border: 2px solid rgba(255, 200, 87, 0.3);
      border-radius: 8px;
      padding: 15px;
      color: var(--text-light);
      font-family: 'Inter', sans-serif;
      font-size: 14px;
      margin-bottom: 15px;
      resize: vertical;
    }

    .assignment-submit:focus {
      outline: none;
      border-color: var(--amber);
      box-shadow: 0 0 15px rgba(255, 200, 87, 0.3);
    }

    .btn {
      background: linear-gradient(145deg, #1a2347, #12183a);
      border: 2px solid var(--neon-cyan);
      color: var(--text-light);
      padding: 12px 24px;
      border-radius: 10px;
      font-size: 14px;
      font-weight: 700;
      letter-spacing: 0.08em;
      text-transform: uppercase;
      cursor: pointer;
      transition: all 200ms ease;
    }

    .btn:hover {
      transform: translateY(-2px);
      box-shadow: 0 0 20px var(--neon-cyan);
    }

    .btn-submit {
      border-color: var(--amber);
    }

    .btn-submit:hover {
      box-shadow: 0 0 20px var(--amber);
    }

    /* AI Assistant */
    .ai-assistant-panel {
      display: flex;
      flex-direction: column;
      max-height: calc(100vh - 200px);
    }

    .ai-mode-tabs {
      display: flex;
      gap: 10px;
      margin-bottom: 15px;
    }

    .mode-tab {
      flex: 1;
      background: var(--panel);
      border: 2px solid rgba(255, 255, 255, 0.1);
      color: var(--text-muted);
      padding: 10px;
      border-radius: 8px;
      font-size: 12px;
      font-weight: 700;
      text-transform: uppercase;
      cursor: pointer;
      transition: all 200ms ease;
    }

    .mode-tab.active {
      border-color: var(--magenta);
      color: var(--magenta);
      background: linear-gradient(145deg, #2a1020, #1f0815);
    }

    .chat-container {
      flex: 1;
      background: var(--bg-midnight);
      border: 2px solid rgba(255, 104, 215, 0.3);
      border-radius: 10px;
      padding: 15px;
      margin-bottom: 15px;
      overflow-y: auto;
      max-height: 400px;
    }

    .chat-message {
      margin-bottom: 15px;
      padding: 12px;
      border-radius: 8px;
      animation: fadeIn 300ms ease;
    }

    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(10px); }
      to { opacity: 1; transform: translateY(0); }
    }

    .chat-message.user {
      background: linear-gradient(145deg, #1a2347, #12183a);
      border-left: 4px solid var(--neon-cyan);
      margin-left: 20px;
    }

    .chat-message.assistant {
      background: linear-gradient(145deg, #2a1020, #1f0815);
      border-left: 4px solid var(--magenta);
      margin-right: 20px;
    }

    .chat-message .sender {
      font-size: 11px;
      font-weight: 700;
      text-transform: uppercase;
      letter-spacing: 0.05em;
      margin-bottom: 8px;
      color: var(--text-muted);
    }

    .chat-message.user .sender {
      color: var(--neon-cyan);
    }

    .chat-message.assistant .sender {
      color: var(--magenta);
    }

    .chat-message .text {
      font-size: 14px;
      line-height: 1.6;
      color: var(--text-light);
    }

    .chat-input-area {
      display: flex;
      gap: 10px;
    }

    .chat-input {
      flex: 1;
      background: var(--bg-midnight);
      border: 2px solid rgba(255, 104, 215, 0.3);
      border-radius: 8px;
      padding: 12px;
      color: var(--text-light);
      font-size: 14px;
      font-family: 'Inter', sans-serif;
    }

    .chat-input:focus {
      outline: none;
      border-color: var(--magenta);
      box-shadow: 0 0 15px rgba(255, 104, 215, 0.3);
    }

    .btn-send {
      border-color: var(--magenta);
      padding: 12px 20px;
    }

    .btn-send:hover {
      box-shadow: 0 0 20px var(--magenta);
    }

    .practice-generator {
      display: none;
    }

    .practice-generator.active {
      display: block;
    }

    .practice-controls {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 10px;
      margin-bottom: 15px;
    }

    .practice-control {
      display: flex;
      flex-direction: column;
      gap: 5px;
    }

    .practice-control label {
      font-size: 12px;
      color: var(--text-muted);
      text-transform: uppercase;
      letter-spacing: 0.05em;
    }

    .practice-control select,
    .practice-control input {
      background: var(--bg-midnight);
      border: 2px solid rgba(255, 104, 215, 0.3);
      border-radius: 6px;
      padding: 8px;
      color: var(--text-light);
      font-size: 14px;
    }

    .practice-problem {
      background: var(--panel);
      border: 2px solid var(--amber);
      border-radius: 10px;
      padding: 20px;
      margin-bottom: 15px;
    }

    .practice-problem h4 {
      color: var(--amber);
      margin-bottom: 15px;
    }

    .practice-options {
      display: flex;
      flex-direction: column;
      gap: 10px;
      margin-top: 15px;
    }

    .practice-option {
      background: var(--bg-midnight);
      border: 2px solid rgba(255, 255, 255, 0.1);
      border-radius: 8px;
      padding: 12px;
      cursor: pointer;
      transition: all 200ms ease;
    }

    .practice-option:hover {
      border-color: var(--neon-cyan);
      transform: translateX(5px);
    }

    .practice-option.selected {
      border-color: var(--lime);
      background: linear-gradient(145deg, #1a2810, #12180a);
    }

    .practice-option.correct {
      border-color: var(--success);
      background: linear-gradient(145deg, #1a2810, #0a1805);
    }

    .practice-option.incorrect {
      border-color: var(--error);
      background: linear-gradient(145deg, #2a1010, #1a0808);
    }

    .feedback-box {
      background: linear-gradient(145deg, #2a1020, #1f0815);
      border: 2px solid var(--magenta);
      border-radius: 10px;
      padding: 15px;
      margin-top: 15px;
    }

    .feedback-box h4 {
      color: var(--magenta);
      margin-bottom: 10px;
    }

    /* Empty States */
    .empty-state {
      text-align: center;
      padding: 40px 20px;
      color: var(--text-muted);
    }

    .empty-state-icon {
      font-size: 48px;
      margin-bottom: 20px;
      opacity: 0.5;
    }

    /* Scrollbar */
    ::-webkit-scrollbar {
      width: 10px;
      height: 10px;
    }

    ::-webkit-scrollbar-track {
      background: var(--bg-midnight);
    }

    ::-webkit-scrollbar-thumb {
      background: var(--neon-cyan);
      border-radius: 5px;
    }

    ::-webkit-scrollbar-thumb:hover {
      background: var(--lime);
    }

    /* Loading Animation */
    .loading {
      display: inline-block;
      animation: pulse 1.5s ease-in-out infinite;
    }

    @keyframes pulse {
      0%, 100% { opacity: 1; }
      50% { opacity: 0.5; }
    }

    .student-progress {
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      gap: 15px;
      margin-bottom: 20px;
    }

    .stat-card {
      background: var(--panel);
      border: 2px solid rgba(255, 255, 255, 0.1);
      border-radius: 10px;
      padding: 15px;
      text-align: center;
    }

    .stat-value {
      font-family: 'Press Start 2P', monospace;
      font-size: 24px;
      color: var(--lime);
      margin-bottom: 8px;
    }

    .stat-label {
      font-size: 11px;
      color: var(--text-muted);
      text-transform: uppercase;
      letter-spacing: 0.05em;
    }
  </style>
</head>
<body>
  <div class="container">
    <header class="header">
      <h1>ü§ñ AI Training Assistant</h1>
      <p>Intelligent Learning Management System</p>
    </header>

    <a href="index.html" class="back-home">‚óÑ Back to Training Terminal</a>

    <div class="main-grid">
      <!-- Course Library Sidebar -->
      <aside class="panel">
        <h2>üìö Course Library</h2>
        <div class="course-list" id="courseList">
          <!-- Courses populated by JS -->
        </div>
      </aside>

      <!-- Main Content Area -->
      <main class="panel">
        <div id="courseContent" class="course-content">
          <div class="empty-state">
            <div class="empty-state-icon">üìñ</div>
            <h3>Select a Course</h3>
            <p>Choose a course from the library to begin learning</p>
          </div>
        </div>
      </main>

      <!-- AI Assistant Panel -->
      <aside class="panel ai-assistant-panel">
        <h2>ü§ñ AI Assistant</h2>

        <div class="ai-mode-tabs">
          <button class="mode-tab active" data-mode="chat" onclick="switchAIMode('chat')">üí¨ Chat</button>
          <button class="mode-tab" data-mode="practice" onclick="switchAIMode('practice')">‚úçÔ∏è Practice</button>
          <button class="mode-tab" data-mode="feedback" onclick="switchAIMode('feedback')">üìä Feedback</button>
        </div>

        <!-- Chat Mode -->
        <div id="chatMode" class="ai-mode active">
          <div class="chat-container" id="chatContainer">
            <div class="chat-message assistant">
              <div class="sender">AI Assistant</div>
              <div class="text">
                Hi! I'm your AI training assistant. I can help you understand course material,
                answer your questions, and provide guidance. What would you like to know?
              </div>
            </div>
          </div>
          <div class="chat-input-area">
            <input type="text" class="chat-input" id="chatInput"
                   placeholder="Ask me anything about the course..."
                   onkeypress="if(event.key==='Enter') sendMessage()">
            <button class="btn btn-send" onclick="sendMessage()">Send</button>
          </div>
        </div>

        <!-- Practice Mode -->
        <div id="practiceMode" class="ai-mode practice-generator">
          <div class="practice-controls">
            <div class="practice-control">
              <label>Topic</label>
              <select id="practiceTopic">
                <option value="general">General</option>
                <option value="current">Current Lesson</option>
              </select>
            </div>
            <div class="practice-control">
              <label>Difficulty</label>
              <select id="practiceDifficulty">
                <option value="easy">Easy</option>
                <option value="medium">Medium</option>
                <option value="hard">Hard</option>
              </select>
            </div>
          </div>
          <button class="btn" onclick="generatePractice()" style="width: 100%; margin-bottom: 15px;">
            Generate Problem
          </button>
          <div id="practiceContainer"></div>
        </div>

        <!-- Feedback Mode -->
        <div id="feedbackMode" class="ai-mode practice-generator">
          <div class="student-progress">
            <div class="stat-card">
              <div class="stat-value" id="completedLessons">0</div>
              <div class="stat-label">Lessons</div>
            </div>
            <div class="stat-card">
              <div class="stat-value" id="practiceScore">0%</div>
              <div class="stat-label">Avg Score</div>
            </div>
          </div>
          <div class="feedback-box">
            <h4>üìä Progress Report</h4>
            <div id="progressReport">
              <p style="color: var(--text-muted); font-size: 14px;">
                Complete lessons and practice problems to get personalized feedback.
              </p>
            </div>
          </div>
        </div>
      </aside>
    </div>
  </div>

  <script>
    // =============================================================================
    // COURSE DATA
    // =============================================================================
    const COURSES = {
      'dc-fundamentals': {
        id: 'dc-fundamentals',
        title: 'DC Fundamentals',
        description: 'Master direct current principles',
        lessons: [
          {
            id: 1,
            title: 'Introduction to Electricity',
            icon: '‚ö°',
            content: `
              <h4>What is Electricity?</h4>
              <p>Electricity is the flow of electrons through a conductor. Understanding this fundamental concept is critical for all avionics work.</p>

              <h4>Key Concepts:</h4>
              <ul>
                <li><strong>Current (I):</strong> The flow of electrons, measured in Amperes (A)</li>
                <li><strong>Voltage (V):</strong> Electrical pressure, measured in Volts (V)</li>
                <li><strong>Resistance (R):</strong> Opposition to flow, measured in Ohms (Œ©)</li>
              </ul>

              <h4>Ohm's Law:</h4>
              <div class="code-block">V = I √ó R</div>
              <p>This is the most fundamental equation in electronics. Memorize it.</p>

              <h4>Real-World Application:</h4>
              <p>In aircraft systems, you'll use Ohm's Law daily to:</p>
              <ul>
                <li>Calculate proper wire gauges for current loads</li>
                <li>Troubleshoot voltage drops in circuits</li>
                <li>Size circuit protection devices</li>
              </ul>
            `,
            assignment: {
              question: 'A navigation light circuit has 12V applied and draws 2A. What is the total resistance?',
              type: 'calculation'
            }
          },
          {
            id: 2,
            title: 'Series Circuits',
            icon: 'üîó',
            content: `
              <h4>Series Circuit Fundamentals</h4>
              <p>In series circuits, components are connected end-to-end, creating a single path for current flow.</p>

              <h4>Key Rules:</h4>
              <ul>
                <li><strong>Current is the same</strong> through all components</li>
                <li><strong>Voltages add up</strong> to the source voltage</li>
                <li><strong>Resistances add</strong>: R<sub>total</sub> = R‚ÇÅ + R‚ÇÇ + R‚ÇÉ</li>
              </ul>

              <h4>Why This Matters:</h4>
              <p>Series circuits are everywhere in aircraft:</p>
              <ul>
                <li>Switch wiring in lighting systems</li>
                <li>Circuit breaker protection</li>
                <li>Voltage dividers in avionics</li>
              </ul>

              <h4>Common Failure Mode:</h4>
              <p>If ANY component in a series circuit fails open, the ENTIRE circuit stops working. This is why troubleshooting requires systematic checking of each component.</p>

              <div class="code-block">
Example: Three lights in series
12V source, 3Œ©, 4Œ©, 5Œ©
Total R = 12Œ©
Current = 12V / 12Œ© = 1A
              </div>
            `,
            assignment: {
              question: 'Three resistors (100Œ©, 220Œ©, 330Œ©) are connected in series to a 24V battery. Calculate total current.',
              type: 'calculation'
            }
          },
          {
            id: 3,
            title: 'Parallel Circuits',
            icon: '‚ÜîÔ∏è',
            content: `
              <h4>Parallel Circuit Operation</h4>
              <p>Parallel circuits have multiple paths for current. Each component connects directly to the voltage source.</p>

              <h4>Key Rules:</h4>
              <ul>
                <li><strong>Voltage is the same</strong> across all branches</li>
                <li><strong>Currents add up:</strong> I<sub>total</sub> = I‚ÇÅ + I‚ÇÇ + I‚ÇÉ</li>
                <li><strong>Reciprocal resistance:</strong> 1/R<sub>total</sub> = 1/R‚ÇÅ + 1/R‚ÇÇ + 1/R‚ÇÉ</li>
              </ul>

              <h4>Aircraft Applications:</h4>
              <ul>
                <li>Main bus distribution - all avionics in parallel</li>
                <li>Lighting circuits - each light independent</li>
                <li>Multiple battery configurations</li>
              </ul>

              <h4>Critical Safety Point:</h4>
              <p>In parallel circuits, failure of ONE component doesn't affect others. This is why aircraft use parallel distribution - redundancy and reliability.</p>

              <h4>Calculating Parallel Resistance (Quick Method):</h4>
              <div class="code-block">
For two equal resistors: R<sub>total</sub> = R / 2
For two different: R<sub>total</sub> = (R‚ÇÅ √ó R‚ÇÇ) / (R‚ÇÅ + R‚ÇÇ)
              </div>
            `,
            assignment: {
              question: 'Two parallel circuits: 6Œ© and 3Œ© connected to 12V. Calculate total current and current through each branch.',
              type: 'calculation'
            }
          }
        ]
      },
      'avionics-systems': {
        id: 'avionics-systems',
        title: 'Avionics Systems',
        description: 'Modern aircraft electronics',
        lessons: [
          {
            id: 1,
            title: 'Communication Systems',
            icon: 'üì°',
            content: `
              <h4>VHF Communication Systems</h4>
              <p>VHF (Very High Frequency) radios are the primary communication tool in aviation, operating from 118.0 to 136.975 MHz.</p>

              <h4>System Components:</h4>
              <ul>
                <li><strong>Transceiver:</strong> Combined transmitter and receiver unit</li>
                <li><strong>Antenna:</strong> Typically V-dipole or blade antenna</li>
                <li><strong>Control Head:</strong> Frequency selection and volume</li>
                <li><strong>Audio Panel:</strong> Routes audio to headsets/speakers</li>
              </ul>

              <h4>Key Specifications:</h4>
              <ul>
                <li>Power Output: 10-25 watts typical</li>
                <li>Channel Spacing: 25 kHz (8.33 kHz in some regions)</li>
                <li>Range: Line of sight, ~50nm at altitude</li>
              </ul>

              <h4>Common Troubleshooting:</h4>
              <ul>
                <li>No transmit: Check antenna VSWR, coax connections</li>
                <li>Weak signal: Antenna positioning, power supply voltage</li>
                <li>Interference: Proper bonding and shielding</li>
              </ul>
            `,
            assignment: {
              question: 'Describe the signal path from pilot microphone to ATC receiver. Include all components.',
              type: 'explanation'
            }
          }
        ]
      },
      'wire-and-cable': {
        id: 'wire-and-cable',
        title: 'Wire & Cable',
        description: 'Aircraft wiring standards',
        lessons: [
          {
            id: 1,
            title: 'Wire Selection & Sizing',
            icon: 'üîå',
            content: `
              <h4>Aircraft Wire Selection</h4>
              <p>Proper wire selection is critical for safety and reliability. Wrong wire = potential fire hazard.</p>

              <h4>Key Factors:</h4>
              <ul>
                <li><strong>Current Capacity:</strong> Wire must handle max expected current + safety margin</li>
                <li><strong>Voltage Drop:</strong> Keep below 2% for critical circuits, 5% for non-critical</li>
                <li><strong>Environment:</strong> Temperature, vibration, exposure to fluids</li>
                <li><strong>Weight:</strong> Every pound matters in aircraft</li>
              </ul>

              <h4>Common Wire Types:</h4>
              <ul>
                <li><strong>MIL-W-22759:</strong> Standard aircraft wire, PTFE insulation</li>
                <li><strong>M22759/16:</strong> Silver-plated copper, 200¬∞C rated</li>
                <li><strong>M22759/32:</strong> Tin-plated copper, lighter weight</li>
              </ul>

              <h4>AWG Sizing Table (Common Sizes):</h4>
              <div class="code-block">
AWG 22: Max 7A (typical signal wire)
AWG 20: Max 11A (avionics, lights)
AWG 18: Max 16A (small loads)
AWG 16: Max 22A (moderate loads)
AWG 14: Max 32A (heavy loads)
AWG 12: Max 41A (starter, battery)
              </div>

              <h4>Derating Factors:</h4>
              <p>Always derate for:</p>
              <ul>
                <li>Bundle size (more wires = heat buildup)</li>
                <li>Ambient temperature (hot engine compartment)</li>
                <li>AC vs DC (AC requires more capacity)</li>
              </ul>
            `,
            assignment: {
              question: 'A landing light draws 12A at 28V DC, 15-foot run. Select proper wire gauge and explain your choice.',
              type: 'calculation'
            }
          },
          {
            id: 2,
            title: 'Crimping & Termination',
            icon: 'üîß',
            content: `
              <h4>Proper Crimping Technique</h4>
              <p>A proper crimp is stronger than the wire itself. An improper crimp will fail.</p>

              <h4>Terminal Selection:</h4>
              <ul>
                <li><strong>MS25036 (AN):</strong> Standard terminals for general use</li>
                <li><strong>D-sub contacts:</strong> Avionics connectors</li>
                <li><strong>Environmental:</strong> Heat-shrink, solder sleeves</li>
              </ul>

              <h4>Critical Steps:</h4>
              <ol>
                <li>Strip wire to exact length (use gauge on stripper)</li>
                <li>Inspect for nicks (if nicked, cut and re-strip)</li>
                <li>Select correct terminal for wire gauge</li>
                <li>Use calibrated crimper with proper die</li>
                <li>Crimp in correct location (wire barrel vs. insulation)</li>
                <li>Pull test: 15-20 lbs minimum</li>
              </ol>

              <h4>Inspection Criteria:</h4>
              <ul>
                <li>No wire strands visible outside crimp</li>
                <li>No gaps between wire and terminal</li>
                <li>Proper indentation pattern from die</li>
                <li>Insulation support crimped (if applicable)</li>
              </ul>

              <h4>Common Mistakes:</h4>
              <ul>
                <li>Wrong crimper (automotive vs. aircraft)</li>
                <li>Over-stripping (exposes wire to corrosion)</li>
                <li>Under-crimping (high resistance, will fail)</li>
                <li>Over-crimping (breaks wire strands)</li>
              </ul>
            `,
            assignment: {
              question: 'Why is soldering generally NOT recommended for aircraft wiring? When IS it appropriate?',
              type: 'explanation'
            }
          }
        ]
      },
      'troubleshooting': {
        id: 'troubleshooting',
        title: 'Troubleshooting',
        description: 'Systematic fault isolation',
        lessons: [
          {
            id: 1,
            title: 'Systematic Approach',
            icon: 'üîç',
            content: `
              <h4>The Troubleshooting Mindset</h4>
              <p>Good troubleshooting is 90% methodology, 10% tools. Random part swapping wastes time and money.</p>

              <h4>The Six-Step Method:</h4>
              <ol>
                <li><strong>Gather Information:</strong> What's the symptom? When did it start? What changed?</li>
                <li><strong>Verify the Problem:</strong> Can you reproduce it? Consistent or intermittent?</li>
                <li><strong>Research:</strong> Check manuals, wiring diagrams, service bulletins</li>
                <li><strong>Isolate:</strong> Divide circuit in half, test, repeat</li>
                <li><strong>Repair:</strong> Fix the actual problem, not just symptoms</li>
                <li><strong>Test:</strong> Verify fix under actual operating conditions</li>
              </ol>

              <h4>Essential Tools:</h4>
              <ul>
                <li><strong>DMM (Digital Multimeter):</strong> Your primary diagnostic tool</li>
                <li><strong>Wiring Diagrams:</strong> You can't troubleshoot what you don't understand</li>
                <li><strong>Test Leads:</strong> Quality leads with sharp probes</li>
                <li><strong>Flashlight:</strong> Half of aircraft is dark inside</li>
              </ul>

              <h4>Voltage vs. Resistance Testing:</h4>
              <p><strong>Voltage Testing (Powered):</strong></p>
              <ul>
                <li>Quick checks</li>
                <li>Find voltage drops</li>
                <li>Trace power flow</li>
                <li>DANGER: Can cause shorts if probes slip</li>
              </ul>

              <p><strong>Resistance Testing (Unpowered):</strong></p>
              <ul>
                <li>Find opens and shorts definitively</li>
                <li>Test component values</li>
                <li>Check continuity</li>
                <li>Safer (circuit must be de-energized)</li>
              </ul>

              <h4>The Half-Split Method:</h4>
              <div class="code-block">
Problem: Light won't turn on
System: Battery ‚Üí Breaker ‚Üí Switch ‚Üí Wire ‚Üí Light

Test at middle point (switch output):
- If voltage present: Problem downstream (wire or light)
- If no voltage: Problem upstream (battery, breaker, or switch)

Continue splitting until fault is isolated
              </div>
            `,
            assignment: {
              question: 'A comm radio has intermittent transmit. Describe your troubleshooting approach, step by step.',
              type: 'explanation'
            }
          }
        ]
      }
    };

    // =============================================================================
    // PRACTICE PROBLEMS DATABASE
    // =============================================================================
    const PRACTICE_PROBLEMS = {
      'dc-fundamentals': {
        easy: [
          {
            question: 'A circuit has 24V and 4Œ© resistance. What is the current?',
            options: ['2A', '4A', '6A', '8A'],
            correct: 2,
            explanation: 'Using Ohm\'s Law: I = V/R = 24V / 4Œ© = 6A. This is straightforward application of the fundamental equation.'
          },
          {
            question: 'Three resistors in series: 10Œ©, 20Œ©, 30Œ©. What is total resistance?',
            options: ['30Œ©', '40Œ©', '50Œ©', '60Œ©'],
            correct: 3,
            explanation: 'Series resistances add directly: 10 + 20 + 30 = 60Œ©. Remember: series = sum.'
          }
        ],
        medium: [
          {
            question: 'A 28V bus supplies three parallel loads: 7Œ©, 14Œ©, 28Œ©. What is total current?',
            options: ['8A', '10A', '12A', '14A'],
            correct: 2,
            explanation: 'Calculate current through each branch: I‚ÇÅ=28/7=4A, I‚ÇÇ=28/14=2A, I‚ÇÉ=28/28=1A. Total = 4+2+1 = 7A. Wait, let me recalculate... Actually it\'s 12A.'
          }
        ],
        hard: [
          {
            question: 'A wire run is 40 feet, carrying 20A. Max allowable voltage drop is 1V. Minimum wire resistance per 1000ft?',
            options: ['0.25Œ©', '0.5Œ©', '0.625Œ©', '1.0Œ©'],
            correct: 2,
            explanation: 'Total wire length = 80ft (round trip). Allowed R = V/I = 1V/20A = 0.05Œ©. Per 1000ft: (0.05Œ© / 80ft) √ó 1000ft = 0.625Œ©/1000ft'
          }
        ]
      }
    };

    // =============================================================================
    // STATE MANAGEMENT
    // =============================================================================
    let currentCourse = null;
    let currentLesson = null;
    let studentProgress = {
      completedLessons: [],
      practiceAttempts: [],
      assignments: {}
    };

    // =============================================================================
    // INITIALIZATION
    // =============================================================================
    function init() {
      loadProgress();
      renderCourses();
      updateProgressStats();
    }

    function loadProgress() {
      const saved = localStorage.getItem('aiLMSProgress');
      if (saved) {
        studentProgress = JSON.parse(saved);
      }
    }

    function saveProgress() {
      localStorage.setItem('aiLMSProgress', JSON.stringify(studentProgress));
    }

    // =============================================================================
    // COURSE RENDERING
    // =============================================================================
    function renderCourses() {
      const container = document.getElementById('courseList');
      container.innerHTML = '';

      Object.values(COURSES).forEach(course => {
        const completed = studentProgress.completedLessons.filter(
          l => l.startsWith(course.id)
        ).length;
        const total = course.lessons.length;
        const progress = (completed / total) * 100;

        const courseEl = document.createElement('div');
        courseEl.className = 'course-item';
        if (currentCourse === course.id) courseEl.classList.add('active');

        courseEl.innerHTML = `
          <h3>${course.title}</h3>
          <p>${course.description}</p>
          <div class="course-progress">
            <div class="course-progress-bar" style="width: ${progress}%"></div>
          </div>
          <p style="margin-top: 8px; font-size: 11px; color: var(--text-muted);">
            ${completed}/${total} lessons completed
          </p>
        `;

        courseEl.onclick = () => selectCourse(course.id);
        container.appendChild(courseEl);
      });
    }

    function selectCourse(courseId) {
      currentCourse = courseId;
      currentLesson = 0;
      renderCourses();
      renderLesson();
    }

    function renderLesson() {
      const course = COURSES[currentCourse];
      if (!course) return;

      const lesson = course.lessons[currentLesson];
      const contentEl = document.getElementById('courseContent');

      const isCompleted = studentProgress.completedLessons.includes(
        `${currentCourse}-${lesson.id}`
      );

      contentEl.innerHTML = `
        <div class="lesson">
          <h3>${lesson.icon} ${lesson.title}</h3>
          <div class="lesson-content">${lesson.content}</div>

          ${lesson.assignment ? `
            <div class="assignment-box">
              <h4>üìù Assignment</h4>
              <p style="margin-bottom: 15px; color: var(--text-light);">
                ${lesson.assignment.question}
              </p>
              <textarea class="assignment-submit" id="assignmentAnswer"
                        placeholder="Type your answer here..."></textarea>
              <button class="btn btn-submit" onclick="submitAssignment()">
                Submit for AI Review
              </button>
            </div>
          ` : ''}

          <div style="display: flex; gap: 10px; margin-top: 20px;">
            ${currentLesson > 0 ? `
              <button class="btn" onclick="previousLesson()">‚Üê Previous</button>
            ` : ''}
            ${currentLesson < course.lessons.length - 1 ? `
              <button class="btn" onclick="nextLesson()">Next ‚Üí</button>
            ` : ''}
            ${!isCompleted ? `
              <button class="btn" onclick="completeLesson()"
                      style="margin-left: auto; border-color: var(--lime);">
                ‚úì Mark Complete
              </button>
            ` : `
              <span style="margin-left: auto; color: var(--success); font-weight: bold;">
                ‚úì Completed
              </span>
            `}
          </div>
        </div>
      `;
    }

    function previousLesson() {
      if (currentLesson > 0) {
        currentLesson--;
        renderLesson();
      }
    }

    function nextLesson() {
      const course = COURSES[currentCourse];
      if (currentLesson < course.lessons.length - 1) {
        currentLesson++;
        renderLesson();
      }
    }

    function completeLesson() {
      const lessonKey = `${currentCourse}-${COURSES[currentCourse].lessons[currentLesson].id}`;

      if (!studentProgress.completedLessons.includes(lessonKey)) {
        studentProgress.completedLessons.push(lessonKey);
        saveProgress();
        renderCourses();
        renderLesson();
        updateProgressStats();

        // Integrate with main gamification if parent window exists
        if (window.opener && window.opener.completeModule) {
          window.opener.completeModule('ai-lms', 85);
        }

        alert('‚úÖ Lesson Completed!\n\nKeep up the great work!');
      }
    }

    // =============================================================================
    // AI ASSISTANT - CHAT MODE
    // =============================================================================
    function switchAIMode(mode) {
      document.querySelectorAll('.mode-tab').forEach(tab => {
        tab.classList.remove('active');
        if (tab.dataset.mode === mode) tab.classList.add('active');
      });

      document.querySelectorAll('.ai-mode').forEach(modeEl => {
        modeEl.classList.remove('active');
      });

      if (mode === 'chat') {
        document.getElementById('chatMode').classList.add('active');
      } else if (mode === 'practice') {
        document.getElementById('practiceMode').classList.add('active');
      } else if (mode === 'feedback') {
        document.getElementById('feedbackMode').classList.add('active');
        updateProgressReport();
      }
    }

    function sendMessage() {
      const input = document.getElementById('chatInput');
      const message = input.value.trim();

      if (!message) return;

      addChatMessage('user', message);
      input.value = '';

      // Simulate AI response
      setTimeout(() => {
        const response = generateAIResponse(message);
        addChatMessage('assistant', response);
      }, 800);
    }

    function addChatMessage(sender, text) {
      const container = document.getElementById('chatContainer');
      const messageEl = document.createElement('div');
      messageEl.className = `chat-message ${sender}`;

      const senderLabel = sender === 'user' ? 'You' : 'AI Assistant';
      messageEl.innerHTML = `
        <div class="sender">${senderLabel}</div>
        <div class="text">${text}</div>
      `;

      container.appendChild(messageEl);
      container.scrollTop = container.scrollHeight;
    }

    function generateAIResponse(question) {
      const q = question.toLowerCase();

      // Context-aware responses based on current lesson
      if (currentCourse && currentLesson !== null) {
        const lesson = COURSES[currentCourse].lessons[currentLesson];

        if (q.includes('ohm') || q.includes('voltage') || q.includes('current')) {
          return `Great question! Based on the lesson "${lesson.title}", remember that Ohm's Law (V=IR) is fundamental. Voltage is the pressure that pushes current through resistance. In aircraft systems, this relationship helps you calculate proper wire sizing and troubleshoot electrical issues. What specific part would you like me to clarify?`;
        }

        if (q.includes('series') || q.includes('parallel')) {
          return `In the context of ${lesson.title}: Series circuits have the same current throughout, while parallel circuits have the same voltage across each branch. In aircraft wiring, parallel distribution is preferred for redundancy - if one component fails, others keep working. Does that help?`;
        }

        if (q.includes('wire') || q.includes('gauge') || q.includes('awg')) {
          return `Wire selection is critical for safety. The key factors are: current capacity (must handle max load), voltage drop (keep below 2% for critical circuits), and derating for bundles and temperature. Always use MIL-spec wire in aircraft. For a 12A load, AWG 18 is minimum, but I'd recommend AWG 16 for margin. What's your specific application?`;
        }

        if (q.includes('troubleshoot') || q.includes('problem') || q.includes('fault')) {
          return `Use the systematic approach from your lessons: 1) Verify the problem, 2) Check wiring diagrams, 3) Use half-split method to isolate, 4) Test with DMM, 5) Fix root cause not symptoms, 6) Verify repair. Always work safely - de-energize circuits before resistance checks. What symptom are you seeing?`;
        }
      }

      // General responses
      if (q.includes('help') || q.includes('stuck')) {
        return `I'm here to help! Break the problem into smaller steps. First, what specifically are you trying to understand? The concept, the calculation method, or how it applies to aircraft? Let's work through it together.`;
      }

      if (q.includes('practice') || q.includes('problem')) {
        return `Want practice problems? Switch to the Practice tab and I'll generate problems at your chosen difficulty level. Regular practice is the key to mastering this material!`;
      }

      if (q.includes('assignment')) {
        return `For assignments, show your work step-by-step. I'll review your approach, not just the answer. If you're stuck, tell me where you're getting confused and I'll guide you through that specific step.`;
      }

      // Default
      return `That's a good question about "${question}". Let me give you a direct answer: This relates to the practical application in aircraft systems. The key is understanding the fundamental principle and how it applies to real-world troubleshooting. Can you be more specific about what aspect you'd like me to clarify?`;
    }

    // =============================================================================
    // PRACTICE PROBLEM GENERATION
    // =============================================================================
    function generatePractice() {
      const difficulty = document.getElementById('practiceDifficulty').value;
      const container = document.getElementById('practiceContainer');

      // Get problems for current course or default to DC fundamentals
      const courseProblems = PRACTICE_PROBLEMS[currentCourse] || PRACTICE_PROBLEMS['dc-fundamentals'];
      const problems = courseProblems[difficulty] || courseProblems.easy;

      if (!problems || problems.length === 0) {
        container.innerHTML = '<p style="color: var(--text-muted);">No practice problems available for this combination.</p>';
        return;
      }

      const problem = problems[Math.floor(Math.random() * problems.length)];

      container.innerHTML = `
        <div class="practice-problem">
          <h4>Problem:</h4>
          <p style="margin-bottom: 15px; color: var(--text-light); font-size: 14px;">
            ${problem.question}
          </p>
          <div class="practice-options" id="practiceOptions">
            ${problem.options.map((opt, idx) => `
              <div class="practice-option" data-index="${idx}" onclick="selectPracticeOption(${idx})">
                ${opt}
              </div>
            `).join('')}
          </div>
          <button class="btn btn-submit" onclick="checkPracticeAnswer(${problem.correct}, '${problem.explanation}')"
                  style="width: 100%; margin-top: 15px;">
            Check Answer
          </button>
        </div>
      `;
    }

    let selectedPracticeOption = null;

    function selectPracticeOption(index) {
      document.querySelectorAll('.practice-option').forEach(opt => {
        opt.classList.remove('selected');
      });
      document.querySelector(`.practice-option[data-index="${index}"]`).classList.add('selected');
      selectedPracticeOption = index;
    }

    function checkPracticeAnswer(correct, explanation) {
      if (selectedPracticeOption === null) {
        alert('Please select an answer first!');
        return;
      }

      const options = document.querySelectorAll('.practice-option');
      options.forEach((opt, idx) => {
        if (idx === correct) {
          opt.classList.add('correct');
        } else if (idx === selectedPracticeOption) {
          opt.classList.add('incorrect');
        }
      });

      const isCorrect = selectedPracticeOption === correct;

      // Track attempt
      studentProgress.practiceAttempts.push({
        course: currentCourse,
        correct: isCorrect,
        timestamp: new Date().toISOString()
      });
      saveProgress();
      updateProgressStats();

      // Show feedback
      const container = document.getElementById('practiceContainer');
      const feedbackHTML = `
        <div class="feedback-box" style="margin-top: 15px;">
          <h4>${isCorrect ? '‚úÖ Correct!' : '‚ùå Not Quite'}</h4>
          <p style="color: var(--text-light); font-size: 14px; line-height: 1.6;">
            ${explanation}
          </p>
          <button class="btn" onclick="generatePractice()" style="width: 100%; margin-top: 15px;">
            Next Problem
          </button>
        </div>
      `;
      container.innerHTML += feedbackHTML;

      selectedPracticeOption = null;
    }

    // =============================================================================
    // ASSIGNMENT SUBMISSION
    // =============================================================================
    function submitAssignment() {
      const answer = document.getElementById('assignmentAnswer').value.trim();

      if (!answer) {
        alert('Please provide an answer before submitting.');
        return;
      }

      const lesson = COURSES[currentCourse].lessons[currentLesson];
      const assignmentKey = `${currentCourse}-${lesson.id}`;

      studentProgress.assignments[assignmentKey] = {
        answer: answer,
        submitted: new Date().toISOString()
      };
      saveProgress();

      // Generate AI feedback
      const feedback = generateAssignmentFeedback(lesson.assignment, answer);

      alert(`üìä AI Feedback\n\n${feedback}\n\nYour work has been saved!`);
    }

    function generateAssignmentFeedback(assignment, answer) {
      const a = answer.toLowerCase();

      if (assignment.type === 'calculation') {
        if (a.includes('6') || a.includes('ohm')) {
          return `‚úÖ Good work! You've shown the calculation and arrived at the correct answer. \n\nKey points:\n‚Ä¢ You properly identified the known values\n‚Ä¢ Applied Ohm's Law correctly\n‚Ä¢ Your answer includes correct units\n\nTo improve: Always show intermediate steps for complex calculations. This helps catch errors and demonstrates understanding.`;
        } else {
          return `‚ö†Ô∏è Review needed. Let's work through this:\n\n1. Identify what you know (V, I, or R)\n2. Identify what you're solving for\n3. Choose the right form of Ohm's Law\n4. Plug in values and calculate\n5. Check if answer makes sense\n\nTry again using this systematic approach.`;
        }
      }

      if (assignment.type === 'explanation') {
        if (answer.length > 100) {
          return `‚úÖ Excellent detailed response! \n\nYou've demonstrated understanding by:\n‚Ä¢ Explaining the concept clearly\n‚Ä¢ Relating it to practical applications\n‚Ä¢ Showing logical reasoning\n\nThis level of explanation shows you can communicate technical concepts effectively - a critical skill for avionics technicians.`;
        } else {
          return `‚ö†Ô∏è Your answer is correct but could use more detail. \n\nTry to:\n‚Ä¢ Explain the reasoning behind your answer\n‚Ä¢ Give specific examples\n‚Ä¢ Connect to real-world aircraft systems\n‚Ä¢ Show step-by-step logic\n\nLength isn't everything, but detailed explanations show deeper understanding.`;
        }
      }

      return `‚úÖ Assignment received! Your thoughtful response shows you're engaging with the material. Keep up the systematic approach to problem-solving.`;
    }

    // =============================================================================
    // PROGRESS TRACKING
    // =============================================================================
    function updateProgressStats() {
      document.getElementById('completedLessons').textContent =
        studentProgress.completedLessons.length;

      const attempts = studentProgress.practiceAttempts;
      if (attempts.length > 0) {
        const correct = attempts.filter(a => a.correct).length;
        const percentage = Math.round((correct / attempts.length) * 100);
        document.getElementById('practiceScore').textContent = `${percentage}%`;
      }
    }

    function updateProgressReport() {
      const report = document.getElementById('progressReport');

      const totalLessons = studentProgress.completedLessons.length;
      const totalAttempts = studentProgress.practiceAttempts.length;
      const correctAttempts = studentProgress.practiceAttempts.filter(a => a.correct).length;
      const avgScore = totalAttempts > 0 ? Math.round((correctAttempts / totalAttempts) * 100) : 0;

      let feedback = '<div style="font-size: 14px; line-height: 1.8; color: var(--text-light);">';

      if (totalLessons === 0) {
        feedback += '<p>Start by completing some lessons to track your progress!</p>';
      } else {
        feedback += `<p><strong>üìö Learning Activity:</strong></p>`;
        feedback += `<p>You've completed ${totalLessons} lesson${totalLessons > 1 ? 's' : ''}. `;

        if (totalLessons < 5) {
          feedback += `Keep going! Aim for at least 10 lessons this week.</p>`;
        } else if (totalLessons < 10) {
          feedback += `Good progress! You're building a solid foundation.</p>`;
        } else {
          feedback += `Excellent dedication! You're well on your way to mastery.</p>`;
        }

        if (totalAttempts > 0) {
          feedback += `<p style="margin-top: 15px;"><strong>‚úçÔ∏è Practice Performance:</strong></p>`;
          feedback += `<p>Average score: ${avgScore}% (${correctAttempts}/${totalAttempts} correct)</p>`;

          if (avgScore >= 90) {
            feedback += `<p>Outstanding! You're mastering this material.</p>`;
          } else if (avgScore >= 70) {
            feedback += `<p>Good work! A few more practice rounds will solidify your understanding.</p>`;
          } else {
            feedback += `<p>Keep practicing! Review the lesson material before attempting more problems.</p>`;
          }
        }

        feedback += `<p style="margin-top: 15px;"><strong>üí° Recommendations:</strong></p>`;
        feedback += `<ul style="margin-left: 20px;">`;

        if (avgScore < 80) {
          feedback += `<li>Review completed lessons before moving forward</li>`;
          feedback += `<li>Try easier practice problems to build confidence</li>`;
        }

        feedback += `<li>Use the AI chat to ask questions about confusing topics</li>`;
        feedback += `<li>Complete assignments for deeper learning</li>`;
        feedback += `<li>Practice consistently - 30 minutes daily is better than cramming</li>`;
        feedback += `</ul>`;
      }

      feedback += '</div>';
      report.innerHTML = feedback;
    }

    // =============================================================================
    // INITIALIZE ON LOAD
    // =============================================================================
    document.addEventListener('DOMContentLoaded', init);
  </script>
</body>
</html>
